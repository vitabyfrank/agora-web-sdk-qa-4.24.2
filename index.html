<!doctype html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Agora ë¼ì´ë¸Œ ìŠ¤íŠ¸ë¦¬ë° (SDK 4.24.2)</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(135deg, #06b6d4 0%, #10b981 100%);
        min-height: 100vh;
        padding: 20px;
      }

      .container {
        max-width: 1400px;
        margin: 0 auto;
        background: white;
        border-radius: 20px;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        overflow: hidden;
      }

      .header {
        background: linear-gradient(135deg, #06b6d4 0%, #10b981 100%);
        color: white;
        padding: 30px;
        text-align: center;
      }

      .header h1 {
        font-size: 2.5em;
        margin-bottom: 10px;
      }

      .header p {
        font-size: 1.1em;
        opacity: 0.9;
      }

      .content {
        padding: 40px;
      }

      .controls {
        background: #f8f9fa;
        padding: 30px;
        border-radius: 15px;
        margin-bottom: 30px;
      }

      .control-group {
        margin-bottom: 20px;
      }

      .control-group label {
        display: block;
        font-weight: 600;
        margin-bottom: 8px;
        color: #333;
        font-size: 0.95em;
      }

      .control-group input,
      .control-group select {
        width: 100%;
        padding: 12px 15px;
        border: 2px solid #e0e0e0;
        border-radius: 8px;
        font-size: 1em;
        transition: all 0.3s;
      }

      .control-group input:focus,
      .control-group select:focus {
        outline: none;
        border-color: #06b6d4;
        box-shadow: 0 0 0 3px rgba(6, 182, 212, 0.1);
      }

      .control-row {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 20px;
        margin-bottom: 20px;
      }

      .button-group {
        display: flex;
        gap: 15px;
        flex-wrap: wrap;
      }

      button {
        padding: 14px 28px;
        font-size: 1em;
        font-weight: 600;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        transition: all 0.3s;
        flex: 1;
        min-width: 150px;
      }

      button:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
      }

      button:active {
        transform: translateY(0);
      }

      button:disabled {
        opacity: 0.5;
        cursor: not-allowed;
        transform: none !important;
      }

      .btn-join {
        background: linear-gradient(135deg, #06b6d4 0%, #0891b2 100%);
        color: white;
      }

      .btn-leave {
        background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
        color: white;
      }

      .btn-publish {
        background: linear-gradient(135deg, #10b981 0%, #059669 100%);
        color: white;
      }

      .btn-unpublish {
        background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
        color: white;
      }

      .video-container {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
        gap: 20px;
        margin-top: 30px;
      }

      .video-player {
        background: #000;
        border-radius: 15px;
        overflow: hidden;
        position: relative;
        aspect-ratio: 16/9;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
      }

      .video-player > div#local-player,
      .video-player > div[id^="player-"] {
        width: 100%;
        height: 100%;
        position: absolute;
        top: 0;
        left: 0;
      }

      .video-player video {
        width: 100%;
        height: 100%;
        object-fit: cover;
        display: block;
      }

      .video-label {
        position: absolute;
        top: 15px;
        left: 15px;
        background: rgba(0, 0, 0, 0.7);
        color: white;
        padding: 8px 16px;
        border-radius: 20px;
        font-weight: 600;
        font-size: 0.9em;
        backdrop-filter: blur(10px);
        z-index: 10;
      }

      .video-label.local {
        background: linear-gradient(135deg, #06b6d4 0%, #0891b2 100%);
      }

      .video-label.remote {
        background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);
      }

      .stats {
        position: absolute;
        bottom: 15px;
        left: 15px;
        right: 15px;
        background: rgba(0, 0, 0, 0.7);
        color: white;
        padding: 10px;
        border-radius: 8px;
        font-size: 0.85em;
        backdrop-filter: blur(10px);
        z-index: 10;
      }

      .status {
        background: #e7f3ff;
        border-left: 4px solid #2196f3;
        padding: 15px 20px;
        margin-bottom: 20px;
        border-radius: 8px;
      }

      .status.error {
        background: #ffebee;
        border-left-color: #f44336;
      }

      .status.success {
        background: #e8f5e9;
        border-left-color: #4caf50;
      }

      .info-box {
        background: #fff3cd;
        border: 1px solid #ffc107;
        padding: 20px;
        border-radius: 8px;
        margin-bottom: 20px;
      }

      .info-box h3 {
        color: #856404;
        margin-bottom: 10px;
      }

      .info-box p {
        color: #856404;
        line-height: 1.6;
      }

      .info-box code {
        background: rgba(0, 0, 0, 0.1);
        padding: 2px 6px;
        border-radius: 4px;
        font-family: "Courier New", monospace;
      }

      #remote-users {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(400px, 1fr));
        gap: 20px;
      }

      .loading {
        display: inline-block;
        width: 20px;
        height: 20px;
        border: 3px solid rgba(255, 255, 255, 0.3);
        border-radius: 50%;
        border-top-color: white;
        animation: spin 1s linear infinite;
      }

      @keyframes spin {
        to {
          transform: rotate(360deg);
        }
      }

      @media (max-width: 768px) {
        .header h1 {
          font-size: 1.8em;
        }

        .content {
          padding: 20px;
        }

        .controls {
          padding: 20px;
        }

        .button-group {
          flex-direction: column;
        }

        button {
          min-width: 100%;
        }

        .video-container,
        #remote-users {
          grid-template-columns: 1fr;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="header">
        <h1>ğŸ¥ Agora ë¼ì´ë¸Œ ìŠ¤íŠ¸ë¦¬ë°</h1>
        <p>SDK 4.24.2 ë²„ì „ì„ ì‚¬ìš©í•œ ì‹¤ì‹œê°„ ë¼ì´ë¸Œ ë°©ì†¡</p>
      </div>

      <div class="content">
        <div class="info-box">
          <h3>âœ… ì¤€ë¹„ ì™„ë£Œ!</h3>
          <p>
            App IDê°€ ì´ë¯¸ ì„¤ì •ë˜ì–´ ìˆìŠµë‹ˆë‹¤. ë°”ë¡œ ì‹œì‘í•˜ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤!
            <br /><br />
            <strong>ì—­í•  ì„ íƒ:</strong>
            <br />â€¢ <code>Host</code>: ìŠ¤íŠ¸ë¦¬ë¨¸ (UID 1004 ê³ ì •, 1ëª…ë§Œ ê°€ëŠ¥)
            <br />â€¢ <code>Audience</code>: ì‹œì²­ì (ìë™ìœ¼ë¡œ Hostì˜ ë°©ì†¡ ì‹œì²­)
            <br /><br />
            <strong>ì‚¬ìš© ë°©ë²•:</strong>
            <br />1. ì²« ë²ˆì§¸ íƒ­: Hostë¡œ ì„¤ì • â†’ ì±„ë„ ì°¸ê°€ (ìë™ ìŠ¤íŠ¸ë¦¬ë° ì‹œì‘)
            <br />2. ë‘ ë²ˆì§¸ íƒ­: Audienceë¡œ ì„¤ì • â†’ ê°™ì€ ì±„ë„ëª…ìœ¼ë¡œ ì°¸ê°€ (ìë™
            ì‹œì²­) <br />3. HostëŠ” í•œ ì±„ë„ì— 1ëª…ë§Œ í—ˆìš©ë©ë‹ˆë‹¤
          </p>
        </div>

        <div class="controls">
          <div class="control-row">
            <!-- <div class="control-group">
              <label for="appid">App ID *</label>
              <input
                type="text"
                id="appid"
                placeholder="Agora App IDë¥¼ ì…ë ¥í•˜ì„¸ìš”"
                value="a4daaf2959744f1c989b869f075fb798"
                readonly
                style="background: #f0f0f0" />
            </div> -->
            <div class="control-group">
              <label for="channel">ì±„ë„ ì´ë¦„ *</label>
              <input
                type="text"
                id="channel"
                placeholder="ì±„ë„ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”"
                value="xplant-4.24.2-test" />
            </div>
          </div>

          <div class="control-row">
            <div class="control-group">
              <label for="role">ì—­í•  ì„ íƒ *</label>
              <select id="role">
                <option value="host">Host (ìŠ¤íŠ¸ë¦¬ë¨¸ - UID 1004)</option>
                <option value="audience">Audience (ì‹œì²­ì)</option>
              </select>
            </div>
          </div>

          <div class="button-group">
            <button class="btn-join" id="join">ì±„ë„ ì°¸ê°€ (Join Channel)</button>
            <button class="btn-leave" id="leave" disabled>
              ì±„ë„ ë‚˜ê°€ê¸° (Leave Channel)
            </button>
            <!-- <button
              class="btn-unpublish"
              id="unpublish"
              disabled
              style="display: none">
              ìŠ¤íŠ¸ë¦¬ë° ì¤‘ì§€ (Stop Streaming)
            </button> -->
          </div>
        </div>

        <div id="status"></div>

        <!-- ë¡œì»¬ ë¹„ë””ì˜¤ -->
        <div class="video-container" id="local-container" style="display: none">
          <div class="video-player">
            <div id="local-player"></div>
            <div class="video-label local">ë‚´ í™”ë©´ (ë¡œì»¬)</div>
            <!-- <div class="stats" id="local-stats"></div> -->
          </div>
        </div>

        <!-- ì›ê²© ì‚¬ìš©ì ë¹„ë””ì˜¤ -->
        <div id="remote-users"></div>
      </div>
    </div>

    <!-- Agora Web SDK 4.24.2 -->
    <script src="https://download.agora.io/sdk/release/AgoraRTC_N-4.24.2.js"></script>

    <script>
      // Agora í´ë¼ì´ì–¸íŠ¸ ì´ˆê¸°í™”
      let client;
      let localTracks = {
        videoTrack: null,
        audioTrack: null,
      };
      let remoteUsers = {};

      // UI ìš”ì†Œ
      const appIdInput = document.getElementById("appid");
      const channelInput = document.getElementById("channel");
      const roleSelect = document.getElementById("role");
      const joinBtn = document.getElementById("join");
      const leaveBtn = document.getElementById("leave");
      const unpublishBtn = document.getElementById("unpublish");
      const statusDiv = document.getElementById("status");
      const localContainer = document.getElementById("local-container");
      const localPlayer = document.getElementById("local-player");
      const remoteUsersDiv = document.getElementById("remote-users");
      const localStatsDiv = document.getElementById("local-stats");

      // ìƒíƒœ ë©”ì‹œì§€ í‘œì‹œ
      function showStatus(message, type = "info") {
        statusDiv.innerHTML = `<div class="status ${type}">${message}</div>`;
        console.log(`[${type.toUpperCase()}] ${message}`);
      }

      // ì±„ë„ ì°¸ê°€
      async function join() {
        const appId = "a4daaf2959744f1c989b869f075fb798";
        const channel = channelInput.value.trim();
        const role = roleSelect.value;

        if (!appId || !channel) {
          showStatus("âŒ ì±„ë„ ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.", "error");
          return;
        }

        try {
          showStatus("ğŸ”„ ì±„ë„ì— ì°¸ê°€ ì¤‘...");

          // í´ë¼ì´ì–¸íŠ¸ ìƒì„±
          client = AgoraRTC.createClient({
            mode: "live",
            codec: "vp8",
            role: role,
          });

          // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“±ë¡
          registerClientEvents();

          // ì±„ë„ ì°¸ê°€
          let uid;
          if (role === "host") {
            // HostëŠ” UID 1004ë¡œ ê³ ì •
            uid = await client.join(appId, channel, null, 1004);
          } else {
            // AudienceëŠ” ëœë¤ UID
            uid = await client.join(appId, channel, null, null);
          }

          showStatus(
            `âœ… ì±„ë„ "${channel}"ì— ì°¸ê°€í–ˆìŠµë‹ˆë‹¤! (UID: ${uid}, ì—­í• : ${role === "host" ? "ìŠ¤íŠ¸ë¦¬ë¨¸" : "ì‹œì²­ì"})`,
            "success",
          );

          // UI ì—…ë°ì´íŠ¸
          joinBtn.disabled = true;
          leaveBtn.disabled = false;

          if (role === "host") {
            // Hostì¸ ê²½ìš°: ìë™ìœ¼ë¡œ ë¡œì»¬ íŠ¸ë™ ìƒì„± ë° ìŠ¤íŠ¸ë¦¬ë° ì‹œì‘
            await createLocalTracks();
            await publish();
            // unpublishBtn.disabled = false;
            // unpublishBtn.style.display = "block";
          } else {
            // Audienceì¸ ê²½ìš°: Host(UID 1004)ë¥¼ ìë™ìœ¼ë¡œ êµ¬ë…
            showStatus("ğŸ“º ìŠ¤íŠ¸ë¦¬ë¨¸ë¥¼ ì°¾ëŠ” ì¤‘...", "info");
          }
        } catch (error) {
          console.error("ì±„ë„ ì°¸ê°€ ì‹¤íŒ¨:", error);
          showStatus(`âŒ ì±„ë„ ì°¸ê°€ ì‹¤íŒ¨: ${error.message}`, "error");
        }
      }

      // ë¡œì»¬ íŠ¸ë™ ìƒì„±
      async function createLocalTracks() {
        try {
          showStatus("ğŸ¥ ì¹´ë©”ë¼ì™€ ë§ˆì´í¬ë¥¼ ì¤€ë¹„ ì¤‘...");

          [localTracks.audioTrack, localTracks.videoTrack] =
            await AgoraRTC.createMicrophoneAndCameraTracks(
              {
                // ì˜¤ë””ì˜¤ ì„¤ì •
                encoderConfig: {
                  sampleRate: 48000,
                  stereo: true,
                  bitrate: 128,
                },
              },
              {
                // ë¹„ë””ì˜¤ ì„¤ì •
                encoderConfig: {
                  width: 1280,
                  height: 720,
                  frameRate: 30,
                  bitrateMin: 600,
                  bitrateMax: 1500,
                },
              },
            );

          // ë¡œì»¬ ë¹„ë””ì˜¤ ì¬ìƒ
          localContainer.style.display = "block";
          localTracks.videoTrack.play("local-player");

          showStatus("âœ… ì¹´ë©”ë¼ì™€ ë§ˆì´í¬ê°€ ì¤€ë¹„ë˜ì—ˆìŠµë‹ˆë‹¤.", "success");

          // í†µê³„ ì—…ë°ì´íŠ¸ ì‹œì‘
          //   updateLocalStats();
        } catch (error) {
          console.error("ë¡œì»¬ íŠ¸ë™ ìƒì„± ì‹¤íŒ¨:", error);
          showStatus(`âŒ ë¯¸ë””ì–´ ì¥ì¹˜ ì ‘ê·¼ ì‹¤íŒ¨: ${error.message}`, "error");
        }
      }

      // ìŠ¤íŠ¸ë¦¬ë° ì‹œì‘ (ë°œí–‰)
      async function publish() {
        if (!localTracks.audioTrack || !localTracks.videoTrack) {
          await createLocalTracks();
        }

        try {
          showStatus("ğŸ“¡ ìŠ¤íŠ¸ë¦¬ë°ì„ ì‹œì‘í•˜ëŠ” ì¤‘...");

          await client.publish([
            localTracks.audioTrack,
            localTracks.videoTrack,
          ]);

          showStatus("âœ… ë¼ì´ë¸Œ ìŠ¤íŠ¸ë¦¬ë°ì´ ì‹œì‘ë˜ì—ˆìŠµë‹ˆë‹¤! ğŸ¬", "success");
        } catch (error) {
          console.error("ë°œí–‰ ì‹¤íŒ¨:", error);
          showStatus(`âŒ ìŠ¤íŠ¸ë¦¬ë° ì‹œì‘ ì‹¤íŒ¨: ${error.message}`, "error");
        }
      }

      // ìŠ¤íŠ¸ë¦¬ë° ì¤‘ì§€ (ë°œí–‰ ì·¨ì†Œ)
      async function unpublish() {
        try {
          showStatus("ğŸ”„ ìŠ¤íŠ¸ë¦¬ë°ì„ ì¤‘ì§€í•˜ëŠ” ì¤‘...");

          await client.unpublish([
            localTracks.audioTrack,
            localTracks.videoTrack,
          ]);

          showStatus("âœ… ìŠ¤íŠ¸ë¦¬ë°ì´ ì¤‘ì§€ë˜ì—ˆìŠµë‹ˆë‹¤.", "success");
          publishBtn.disabled = false;
          unpublishBtn.disabled = true;
        } catch (error) {
          console.error("ë°œí–‰ ì·¨ì†Œ ì‹¤íŒ¨:", error);
          showStatus(`âŒ ìŠ¤íŠ¸ë¦¬ë° ì¤‘ì§€ ì‹¤íŒ¨: ${error.message}`, "error");
        }
      }

      // ì±„ë„ ë‚˜ê°€ê¸°
      async function leave() {
        try {
          showStatus("ğŸ”„ ì±„ë„ì„ ë‚˜ê°€ëŠ” ì¤‘...");

          // ë¡œì»¬ íŠ¸ë™ ì •ë¦¬
          if (localTracks.audioTrack) {
            localTracks.audioTrack.stop();
            localTracks.audioTrack.close();
            localTracks.audioTrack = null;
          }
          if (localTracks.videoTrack) {
            localTracks.videoTrack.stop();
            localTracks.videoTrack.close();
            localTracks.videoTrack = null;
          }

          // ì›ê²© ì‚¬ìš©ì ì •ë¦¬
          remoteUsers = {};
          remoteUsersDiv.innerHTML = "";

          // í´ë¼ì´ì–¸íŠ¸ ë‚˜ê°€ê¸°
          await client.leave();

          localContainer.style.display = "none";
          showStatus("âœ… ì±„ë„ì„ ë‚˜ê°”ìŠµë‹ˆë‹¤.", "success");

          // UI ì´ˆê¸°í™”
          joinBtn.disabled = false;
          leaveBtn.disabled = true;
          //   unpublishBtn.disabled = true;
        } catch (error) {
          console.error("ì±„ë„ ë‚˜ê°€ê¸° ì‹¤íŒ¨:", error);
          showStatus(`âŒ ì±„ë„ ë‚˜ê°€ê¸° ì‹¤íŒ¨: ${error.message}`, "error");
        }
      }

      // í´ë¼ì´ì–¸íŠ¸ ì´ë²¤íŠ¸ ë“±ë¡
      function registerClientEvents() {
        // ì‚¬ìš©ì ë°œí–‰
        client.on("user-published", async (user, mediaType) => {
          console.log("ğŸ”” ì‚¬ìš©ì ë°œí–‰:", user.uid, mediaType);
          console.log("í˜„ì¬ ì—­í• :", roleSelect.value);

          // Audience ëª¨ë“œì´ê³  Host(UID 1004)ê°€ ë°œí–‰í•˜ë©´ ìë™ êµ¬ë…
          if (roleSelect.value === "audience" && user.uid === 1004) {
            showStatus(
              `âœ… ìŠ¤íŠ¸ë¦¬ë¨¸ë¥¼ ì°¾ì•˜ìŠµë‹ˆë‹¤! (UID: ${user.uid})`,
              "success",
            );
          }

          await subscribe(user, mediaType);
        });

        // ì‚¬ìš©ì ë°œí–‰ ì·¨ì†Œ
        client.on("user-unpublished", (user, mediaType) => {
          console.log("ì‚¬ìš©ì ë°œí–‰ ì·¨ì†Œ:", user.uid, mediaType);
          if (mediaType === "video") {
            const playerDiv = document.getElementById(
              `player-wrapper-${user.uid}`,
            );
            if (playerDiv) {
              playerDiv.remove();
            }
          }
        });

        // ì‚¬ìš©ì ë‚˜ê°
        client.on("user-left", user => {
          console.log("ì‚¬ìš©ì ë‚˜ê°:", user.uid);
          delete remoteUsers[user.uid];
          const playerDiv = document.getElementById(
            `player-wrapper-${user.uid}`,
          );
          if (playerDiv) {
            playerDiv.remove();
          }

          // Hostê°€ ë‚˜ê°„ ê²½ìš°
          if (user.uid === 1004 && roleSelect.value === "audience") {
            showStatus("âš ï¸ ìŠ¤íŠ¸ë¦¬ë¨¸ê°€ ë°©ì†¡ì„ ì¢…ë£Œí–ˆìŠµë‹ˆë‹¤.", "error");
          }
        });

        // ë„¤íŠ¸ì›Œí¬ í’ˆì§ˆ
        client.on("network-quality", stats => {
          console.log("ë„¤íŠ¸ì›Œí¬ í’ˆì§ˆ:", stats);
        });

        // ì—°ê²° ìƒíƒœ ë³€ê²½
        client.on("connection-state-change", (curState, prevState, reason) => {
          console.log(
            `ì—°ê²° ìƒíƒœ ë³€ê²½: ${prevState} -> ${curState}, ì´ìœ : ${reason}`,
          );
          if (curState === "DISCONNECTED") {
            showStatus("âš ï¸ ì—°ê²°ì´ ëŠì–´ì¡ŒìŠµë‹ˆë‹¤.", "error");
          } else if (curState === "CONNECTED") {
            showStatus("âœ… ì—°ê²°ë˜ì—ˆìŠµë‹ˆë‹¤.", "success");
          }
        });
      }

      // ì›ê²© ì‚¬ìš©ì êµ¬ë…
      async function subscribe(user, mediaType) {
        try {
          console.log("â³ êµ¬ë… ì‹œì‘:", user.uid, mediaType);
          await client.subscribe(user, mediaType);
          console.log("âœ… êµ¬ë… ì„±ê³µ:", user.uid, mediaType);

          if (mediaType === "video") {
            console.log("ğŸ¥ ë¹„ë””ì˜¤ ì¬ìƒ ì‹œì‘:", user.uid);
            const playerDiv =
              document.getElementById(`player-${user.uid}`) ||
              createRemotePlayerDiv(user.uid);
            user.videoTrack.play(`player-${user.uid}`);
            console.log("âœ… ë¹„ë””ì˜¤ ì¬ìƒ ì™„ë£Œ:", user.uid);
          }

          if (mediaType === "audio") {
            console.log("ğŸ”Š ì˜¤ë””ì˜¤ ì¬ìƒ:", user.uid);
            user.audioTrack.play();
          }

          remoteUsers[user.uid] = user;
        } catch (error) {
          console.error("âŒ êµ¬ë… ì‹¤íŒ¨:", error);
          showStatus(`âŒ êµ¬ë… ì‹¤íŒ¨: ${error.message}`, "error");
        }
      }

      // ì›ê²© ì‚¬ìš©ì í”Œë ˆì´ì–´ ìƒì„±
      function createRemotePlayerDiv(uid) {
        console.log("ğŸ“º ì›ê²© í”Œë ˆì´ì–´ ìƒì„±:", uid);
        const playerDiv = document.createElement("div");
        playerDiv.id = `player-wrapper-${uid}`;
        playerDiv.className = "video-player";
        playerDiv.innerHTML = `
                 <div id="player-${uid}"></div>
                 <div class="video-label remote">${uid === 1004 ? "ìŠ¤íŠ¸ë¦¬ë¨¸ (Host)" : `ì‚¬ìš©ì ${uid}`}</div>
                 `;
        //  <div class="stats" id="stats-${uid}"></div>
        remoteUsersDiv.appendChild(playerDiv);
        console.log("âœ… ì›ê²© í”Œë ˆì´ì–´ DOM ì¶”ê°€ ì™„ë£Œ:", uid);

        // ì›ê²© ì‚¬ìš©ì í†µê³„ ì—…ë°ì´íŠ¸
        // updateRemoteStats(uid);

        return `player-${uid}`;
      }

      // ë¡œì»¬ í†µê³„ ì—…ë°ì´íŠ¸
      function updateLocalStats() {
        setInterval(() => {
          if (localTracks.videoTrack && localTracks.videoTrack.isPlaying) {
            const stats = localTracks.videoTrack.getStats();
            localStatsDiv.innerHTML = `
                        ğŸ“Š í•´ìƒë„: ${stats.captureResolutionWidth}x${stats.captureResolutionHeight} | 
                        í”„ë ˆì„: ${stats.captureFrameRate} fps
                    `;
          }
        }, 1000);
      }

      // ì›ê²© í†µê³„ ì—…ë°ì´íŠ¸
      function updateRemoteStats(uid) {
        setInterval(() => {
          const user = remoteUsers[uid];
          if (user && user.videoTrack) {
            const stats = user.videoTrack.getStats();
            const statsDiv = document.getElementById(`stats-${uid}`);
            if (statsDiv) {
              statsDiv.innerHTML = `
                            ğŸ“Š í•´ìƒë„: ${stats.receiveResolutionWidth}x${stats.receiveResolutionHeight} | 
                            í”„ë ˆì„: ${stats.receiveFrameRate} fps 
                        `;
            }
          }
        }, 1000);
      }

      // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
      joinBtn.addEventListener("click", join);
      leaveBtn.addEventListener("click", leave);
      unpublishBtn.addEventListener("click", unpublish);

      // í˜ì´ì§€ ì–¸ë¡œë“œ ì‹œ ì •ë¦¬
      window.addEventListener("beforeunload", () => {
        if (client) {
          leave();
        }
      });

      // ì´ˆê¸° ë©”ì‹œì§€
      showStatus(
        'ğŸ‘‹ ì—­í• ì„ ì„ íƒí•˜ê³  ì±„ë„ ì´ë¦„ì„ ì…ë ¥í•œ í›„ "ì±„ë„ ì°¸ê°€" ë²„íŠ¼ì„ í´ë¦­í•˜ì„¸ìš”.',
      );
    </script>
  </body>
</html>
